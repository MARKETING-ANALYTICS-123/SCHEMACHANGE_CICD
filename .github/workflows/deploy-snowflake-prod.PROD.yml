name: Deploy to PROD Snowflake

on:
  push:
    branches: [PROD]
    paths: ['dbscripts2/**']
  workflow_dispatch:

jobs:
  deploy-to-prod:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v3

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.8

      - name: Install dependencies
        run: pip install snowflake-connector-python

      - name: Write private key to file
        run: |
          mkdir -p keys
          echo "${{ secrets.PROJECT_A_PRIVATE_KEY }}" > keys/temp_key.p8
          chmod 600 keys/temp_key.p8

      - name: Deploy SQL to PROD
        env:
          CONFIG_FILE: configs/project-a.json
        run: python deploy_sql_files.py

